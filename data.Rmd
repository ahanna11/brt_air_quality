---
title: "tables and figures"
author: "Abby Hanna"
date: "4/25/2020"
output: pdf_document
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(formattable)
library(ggplot2)
library(stargazer)
library(tableone)
library(readr) 
library(dummies)
```


```{r import data}
sa_o_paulo_transportation <- read_csv("s達o-paulo-transportation.csv")
sum_stats_values <- CreateTableOne(data = sa_o_paulo_transportation)
summary(sum_stats_values)
```



```{r read in air data}

air_data <- read_csv("cetesb.csv", 
    col_types = cols(BENZENO = col_double(), 
        CO = col_double(), MP2.5 = col_double(), 
        SO2 = col_double(), TOLUENO = col_double(), 
        TRS = col_double())) %>% 
  mutate(year = year(time),
         month = month(time),
         day = day(time),
         hour = hour(time),
         date = as.Date(str_c(year,"-", month, "-", day),"%Y-%m-%d")) %>% 
  select(id, hour, ozone = O3, date) 
```


$
## Variable descriptions 

\begin{table}
\centering
\caption{Variable definitions}
\label{variableDefinitions}
\begin{tabular}{ll}
\hline
Variable name      & Description                                  \\
\hline
\hline
id                 & Identification number for city               \\
hour               & Hour recorded at station                     \\
mean_ozone         & Daily average ozone level                    \\
min_ozone          & Daily average minimum ozone level            \\
max_ozone          & Daily average maximum ozone level            \\
after_WC           & Dummy variable: 1 if city of S達o Paulo, 0 if other \\
date               & Day recorded at station                      \\                            
temperature        & Average temperature recorded                 \\
windspeed          & Average windspeed recorded                   \\
humidity           & Average humidity recorded                    \\
\hline
\end{tabular}
\end{table}
$




```{r  read in station data, echo = F, results = 'asis'}
estacoes_cetesb <- read_csv("estacoes-cetesb.csv")


# Stations in the city of Sao Paulo -  ozone readings  
sao_paulo_stations <-estacoes_cetesb %>% 
  filter(`Municipio` == "SAO PAULO" & POLUENTE == "O3") %>% 
  select(id = ID, longitude = x, latitude = y, municipality = Municipio)

sp_ozone_data_hourly <- sp_ozone_daily %>% 
  left_join(air_data)

sp_ozone_daily <- sp_ozone_data_hourly %>% 
  group_by(date) %>% 
  summarize(mean_ozone = mean(ozone, na.rm = T), 
            max_ozone = max(ozone, na.rm = T),
            min_ozone = min(ozone, na.rm = T))

# Stations in the state of Sao Paulo  -  ozone readings
other_stations <- estacoes_cetesb %>%
  filter(`Municipio` != "SAO PAULO" & POLUENTE == "O3") %>%
  select(id = ID, longitude = x, latitude = y, municipality = Municipio)

other_ozone_daily <- other_ozone_hourly %>% 
  group_by(date) %>% 
  summarize(mean_ozone = mean(ozone, na.rm = T), 
            max_ozone = max(ozone, na.rm = T),
            min_ozone = min(ozone, na.rm = T))

other_ozone_hourly <- other_stations %>%
  left_join(air_data)

# Stations in SP city after 2014 -  ozone readings
require(lubridate)
hourly_2014 <- sp_ozone_data_hourly %>%
  mutate(date >= "2015-01-01") %>%
  select(date)

hourly_ozonesp_2014 <- hourly_2014 %>%
  left_join(air_data)


```


```{r}

stargazer::stargazer(as.data.frame(sp_ozone_data_hourly),
                     label = "Summary Statistics, Hourly Ozone Level")

stargazer::stargazer(as.data.frame(sp_ozone_daily),
                     label = "Summary Statistics Daily Ozone Level",
                     title = "SumStats", 
                     header = F, 
                     type = "latex",
                     digits = 0)

```




```{r create weather sum tables, echo = F, results = 'asis'}
sudeste <- read_csv("sudeste.csv")

weather_stats <- sudeste %>% 
  group_by(city) %>%
  mutate(temp = mean(temp),
         hmdy = mean(hmdy),
         wdsp = mean(wdsp)) %>%
  select(date, temp, hmdy, wdsp, city)


#climate data in city of SP
sao_weather <- sudeste %>%
  filter(city == "S達o Paulo") %>%
  mutate(temp = mean(temp),
         hmdy = mean(hmdy),
         wdsp = mean(wdsp)) %>%
  select(date, temp, hmdy, wdsp, city)
stargazer(sao_weather)

#climate data in state of SP
other_weather <- sudeste %>%
  filter(city != "S達o Paulo") %>%
   mutate(temp = mean(temp),
         hmdy = mean(hmdy),
         wdsp = mean(wdsp)) %>%
  select(date, temp, hmdy, wdsp, city)
stargazer(other_weather)

#climate data after 2014
climate_2015 <- sudeste %>%
  filter(date >= "2015-01-01") %>%
  select(date, temp, hmdy, wdsp, city)
stargazer(climate_2015)


```





```{r regression on ozone}

regression_results <- lm(SPozone ~ after_wc +  + exposed*after + as.factor(hour) + mean(temp) + mean(wdsp) + mean(hmdy), 
                         data = )                  
                 

```








