---
title: "Data section"
author: "Abby Hanna"
date: "4/19/2020"
output: html_document
---


```{r}
knitr::opts_chunk$set(results = 'asis', cache = F)
library(tidyverse)
library(readr)
library(summarytools)
st_options(plain.ascii = F,
           style = "rmarkdown",
           footnote = NA,
           subtitle.emphasis = F,
           dfSummary.silent = T,
           dfSummary.valid.col = F,
           tmp.img.dir = "./tmp",
           dfSummary.style = "grid")
```

## Appendix description

# This Data Appendix documents the data used in "Effects of BRT on Air Quality in Brazilian Cities". It was prepared in a Rmarkdown document that contains both the documentation and the R code used to prepare the data used in the final estimation. It also includes descriptive statistics for both the original data and the final dataset, with a discussion of any issues of note.

# The datasets used directly by the final analysis are saved in `processed-data/` at the end of this file.


```{r insert BRT data for SP}
sp_transportation_2018 <- read_csv("~/Desktop/saÌƒo-paulo-transportation.csv")
View(sp_transportation_2018)
```


```{r insert pollution data SP region, 2013-2019}
air_data <- read_csv("cetesb.csv", 
    col_types = cols(BENZENO = col_double(), 
        CO = col_double(), MP2.5 = col_double(), 
        SO2 = col_double(), TOLUENO = col_double(), 
        TRS = col_double())) %>% 
  mutate(year = year(time),
         month = month(time),
         day = day(time),
         hour = hour(time),
         date = as.Date(str_c(year,"-", month, "-", day),"%Y-%m-%d")) %>% 
  select(id, hour, ozone = O3, date) 
```
```{r air pollution from stations}
stations <- read_csv("estacoes-cetesb.csv")

sao_paulo_stations <- stations %>% 
  filter(Municipio == "SAO PAULO" & Qualidade == "N1 - BOA" & POLUENTE == "O3") %>% 
  select(id = ID, longitude = x, latitude = y, municipality = Municipio)

sp_ozone_data_hourly <- sao_paulo_stations %>% 
  left_join(air_data)


sp_ozone_daily <- sp_ozone_data_hourly %>% 
  group_by(sp_ozone_daily$date) %>% 
  summarize(mean_ozone = mean(ozone, na.rm = T), 
            max_ozone = max(ozone, na.rm = T),
            min_ozone = min(ozone, na.rm = T))
```


A few tips:

- When creating a list like this one, be sure to put an empty line above the list. If you don't do this, your entries won't be formatted a list.
- Make sure you have empty lines above and below section and subsection headings.
- When creating numbered lists, you can number all items in your list with 1. Rmarkdown will number them sequentially when it creates your final document.

# Raw data
*Each dataset you use will have its own documentation section. The next subsection in this document (Dataset description) is a template. You can copy this section and paste it into your document each time you need to add a section for a new dataset. Note that each line in the Dataset description section __must__ end with two spaces.* 
This section documents the datasets used in this analysis.

## Dataset description
**Citation:** Put citation here in APA or other consistent format that you will use throughout the project. Include a hyperlink if applicable.  
**DOI:** If the dataset has a documention identified (DOI) assigned put it here.  
**Date Downloaded:** Identify when you downloaded the dataset.  
**Filename(s):** raw_data/filename.csv *If you have a large number of files you can use a patten (see visit data below)*
**Unit of observation:** What distinguishes different rows in your dataset?  
**Dates covered:** What time frame does the data cover?  

### To obtain a copy

Describe in a step-by-step fashion how an interested user could obtain the data.

### Importable version (if necessary)

**Filename(s):** importable-data/filename-importable.csv

In some cases the raw data is not directly importable. In this case, you should fully document every step you took to create the importable data in a subsection like this one. 

### Variable descriptions

Create a bullet list with the name of each variable in the dataset followed by any information the user would need to understand it.

- **variable_name:** Variable description. 
- **variable_name2:** Description of second variable.

### Data import code and summary

*Once you've described the variables, enter an R chunk by selecting Code -> Insert Chunk, or Ctrl+Alt+I, give it a name to describe the dataset you are importing. After importing, export a dataframe summary using the command.*

`export_summary_table(dfSummary(dataset_name))`

*While it will make your resulting file long, you should not modify the chunk options to suppress printing of code and output. I would likely not include this in the documentation for an actual paper I was submitting, but including them here will let me read your code and the output message from R and may help identify data import concerns early in the process. Since these files will exist only electronically, their length is less of a concern. If you like to print out files to proofread and want me to help you shorten the printed versions, let me know. We can temporarily modify the chunk options for printing and restore them before you submit the assignment.*


# Data Processing and Combination
*This section should include a discussion of the processing and merging steps needed to create your basic data. The code to implement these steps should be included in chunks in this section. Once the final merged data has been created, you should use the dfSummary function again to summarize the data you will be using. You should also save a file containing all the objects you will use in your final analysis to the processed_data folder.*

# Analysis Variables

This section should include a description of all the variables that are used in your final analysis. At the end of the section, you should save all of these variables in the processed_data folder of your repository.

# Discussion of Data

*This section should include a discussion of any data patterns you notice based on the summaries created in the code above.*