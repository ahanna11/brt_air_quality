---
title: "data_draft"
author: "Abby Hanna"
date: "4/25/2020"
output:
  pdf_document: default
  html_document: default
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(formattable)
library(ggplot2)
library(stargazer)
library(tableone)
```


```{r import data}
air_data <- read_csv("cetesb.csv", 
    col_types = cols(BENZENO = col_double(), 
        CO = col_double(), MP2.5 = col_double(), 
        SO2 = col_double(), TOLUENO = col_double(), 
        TRS = col_double())) %>% 
  mutate(year = year(time),
         month = month(time),
         day = day(time),
         hour = hour(time),
         date = as.Date(str_c(year,"-", month, "-", day),"%Y-%m-%d")) %>% 
  select(id, hour, ozone = O3, date) 
```


$
## Variable descriptions 

\begin{table}
\centering
\caption{Variable definitions}
\label{variableDefinitions}
\begin{tabular}{ll}
\hline
Variable name      & Description                                  \\
\hline
\hline
id                 & Identification number for city               \\
hour               & Hour recorded at station                     \\
mean_ozone         & Daily average ozone level                    \\
min_ozone          & Daily average minimum ozone level            \\
max_ozone          & Daily average maximum ozone level            \\
after_WC           & Dummy variable: 1 if city of São Paulo, 0 if other \\
date               & Day recorded at station                      \\                            
temperature        & Average temperature recorded                 \\
windspeed          & Average windspeed recorded                   \\
humidity           & Average humidity recorded                    \\
\hline
\end{tabular}
\end{table}
$

```{r create weather sum table, echo = F, results = 'asis'}

sudeste <- read_csv("sudeste.csv")

weather_stats <- sudeste %>% 
  group_by(city) %>%
  mutate(temp = mean(temp),
         hmdy = mean(hmdy),
         wdsp = mean(wdsp)) %>%
  select(date, temp, hmdy, wdsp)

stargazer::stargazer(weather_stats)
```


```{r read in station data, summart stats for stations}
stations <- read_csv("estacoes-cetesb.csv")

sao_paulo_stations <- stations %>% 
  filter(Municipio == "SAO PAULO" & POLUENTE == "O3") %>% 
  select(id = ID, longitude = x, latitude = y, municipality = Municipio)
  
summary(sao_paulo_stations)

other_stations <- stations %>%
  filter(Municipio != "SAO PAULO" & POLUENTE == "O3") %>%
  select(id = ID, longitude = x, latitude = y, municipality = Municipio)

summary(other_stations)

sp_ozone_daily <- sp_ozone_data_hourly %>% 
  group_by(date) %>% 
  summarize(mean_ozone = mean(ozone, na.rm = T), 
            max_ozone = max(ozone, na.rm = T),
            min_ozone = min(ozone, na.rm = T))

```

```{r hourly ozone data, echo = F, results = 'asis'}

sp_ozone_data_hourly <- sao_paulo_stations %>% 
  left_join(air_data)
summary(sp_ozone_data_hourly)

stargazer::stargazer(as.data.frame(sp_ozone_data_hourly),
                     label = "Summary Statistics, Hourly Ozone Level")
```



```{r}
stargazer::stargazer(as.data.frame(sp_ozone_daily),
                     label = "Summary Statistics Daily Ozone Level",
                     title = "SumStats", 
                     header = F, 
                     type = "latex",
                     digits = 0)
```


```{r}
library(readr) 
library(tableone)
sa_o_paulo_transportation <- read_csv("são-paulo-transportation.csv")

sum_stats_values <- CreateTableOne(data = sa_o_paulo_transportation)
summary(sum_stats_values)

```




```{r creation of dummy variable}

after_WC <- ifelse(air_data$date>"2014-12-30",1,0)

```




```{r regression on ozone}
ozone_regr <- lm(sp_ozone_data_hourly ~ after_WC + )
```





